#summary Design of tool to change layout of files on ext3 filesystem
#labels design,ext3,Phase-Design

= Introduction =
This tool will change layout of files needed for application/system start in order to reduce number of disk seeks.

Input to this module will be layout generated by logic module, based on application and system startup traces. The logic is *not* contained in this module.

= Design goals =
  * Relocator must be resistant to errors in input (so that user cannot screw his disk by feeding wrong file to relocator) 
  * Relocator should be simple - the logic should be outside relocator 
  * Relocator should be flexible - it should take any layout generated by the logic module and lay out files on disk (subject to filesystem structure constraints) 
  * Created disk layout should be minimal in terms of disk seek distances, ideally blocks should be subsequent on disk.

= Design decisions =
  * Input file will specify explicite indirect blocks to be moved (see  [http://groups.google.com/group/prefetch-devel/msg/a506250976e66de1 this e-mail]). "Smart" mode (leaving handling indirect blocks to remapper) will be introduced later if necessary. Rationale:
     * Logic module should have full control over layout (see design goals).
  * ext3remapper tool by Jan Kara will be used as base for layout tool. Rationale (see  [http://groups.google.com/group/prefetch-devel/msg/a506250976e66de1 this e-mail]):
     * It allows for moving indirect blocks explicite specified in input file (see above)
     * It is more advanced in terms of parsing log and interface.
     
= Implementation issues/TODO =
  * ext3remapper does not support sparse files (will be implemented by Krzysztof Lichota)
  * ext3remapper does not support relocating inodes (being worked on by Jan Kara)
     * in relocating inodes the hard part and special case are hard links
  * ext3remapper does not support input as file paths (will be implemented by Krzysztof Lichota)

= Discussions =
Discussion threads:
   * http://groups.google.com/group/prefetch-devel/browse_thread/thread/2d800df1ceaab5ae/e0bbb68fe61b3725#e0bbb68fe61b3725